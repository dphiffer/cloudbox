(function(b){var a=(function(){var c=b.documentMode;return("onhashchange" in b)&&(c===undefined||c>7)})();L.Hash=function(c){this.onHashChange=L.Util.bind(this.onHashChange,this);if(c){this.init(c)}};L.Hash.parseHash=function(f){if(f.indexOf("#")===0){f=f.substr(1)}var c=f.split("/");if(c.length==3){var d=parseInt(c[0],10),e=parseFloat(c[1]),g=parseFloat(c[2]);if(isNaN(d)||isNaN(e)||isNaN(g)){return false}else{return{center:new L.LatLng(e,g),zoom:d}}}else{return false}};L.Hash.formatHash=function(f){var c=f.getCenter(),e=f.getZoom(),d=Math.max(0,Math.ceil(Math.log(e)/Math.LN2));return"#"+[e,c.lat.toFixed(d),c.lng.toFixed(d)].join("/")},L.Hash.prototype={map:null,lastHash:null,parseHash:L.Hash.parseHash,formatHash:L.Hash.formatHash,init:function(c){this.map=c;this.lastHash=null;this.onHashChange();if(!this.isListening){this.startListening()}},removeFrom:function(c){if(this.changeTimeout){clearTimeout(this.changeTimeout)}if(this.isListening){this.stopListening()}this.map=null},onMapMove:function(){if(this.movingMap||!this.map._loaded){return false}var c=this.formatHash(this.map);if(this.lastHash!=c){location.replace(c);this.lastHash=c}},movingMap:false,update:function(){var d=location.hash;if(d===this.lastHash){return}var c=this.parseHash(d);if(c){this.movingMap=true;this.map.setView(c.center,c.zoom);this.movingMap=false}else{this.onMapMove(this.map)}},changeDefer:100,changeTimeout:null,onHashChange:function(){if(!this.changeTimeout){var c=this;this.changeTimeout=setTimeout(function(){c.update();c.changeTimeout=null},this.changeDefer)}},isListening:false,hashChangeInterval:null,startListening:function(){this.map.on("moveend",this.onMapMove,this);if(a){L.DomEvent.addListener(b,"hashchange",this.onHashChange)}else{clearInterval(this.hashChangeInterval);this.hashChangeInterval=setInterval(this.onHashChange,50)}this.isListening=true},stopListening:function(){this.map.off("moveend",this.onMapMove,this);if(a){L.DomEvent.removeListener(b,"hashchange",this.onHashChange)}else{clearInterval(this.hashChangeInterval)}this.isListening=false}};L.hash=function(c){return new L.Hash(c)};L.Map.prototype.addHash=function(){this._hash=L.hash(this)};L.Map.prototype.removeHash=function(){this._hash.removeFrom()}})(window);
